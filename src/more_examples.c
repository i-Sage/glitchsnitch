#include "glitchsnitch.h"

#include <stdint.h>


/// !=======================================================================================================================
/// !                                                           FUNCTIONS
/// !=======================================================================================================================


int add_function(int a, int b) {
    return a + b;
}

void set_bit(uint8_t *flag, uint8_t position) {
    *flag |= 1 << position;
}

void burn_and_die(void) {
    int *null_ptr = NULL;
    CHECK_PTR(null_ptr);
}

/// !=======================================================================================================================
/// !                                                           FUNCTIONS
/// !=======================================================================================================================



/// !=======================================================================================================================
/// !                                                           TESTS
/// !=======================================================================================================================

int test_burn_and_die(void) {
    TEST_EXPECT_CRASH({burn_and_die();}, "null ptr crashes the program as expected");
    return 1;
}

int test_crash(void) {
    TEST_EXPECT_CRASH(
        {
            int size = 28;
            CHECK(size > 30, "size is less than 30");
        },
        "BURN AND DIE!!"
    );
}

int test_set_bit_function() {
    uint8_t flag = 0;
    set_bit(&flag, 0);

    TEST_ASSERT(flag == 1, "set_bit sets bit position 0");

    return 1;
}


int test_add_function(void) {
    TEST_ASSERT_EQ(add_function(3, 3), 6, "actual matches expected");
    return 1;
}

/// !=======================================================================================================================
/// !                                                           TESTS
/// !=======================================================================================================================





/// !=======================================================================================================================
/// !                                                       TEST RUNNER
/// !=======================================================================================================================
int main() {

    BENCHMARK_START();
    for (size_t i = 0; i < (int)10e6; ++i) {
        continue;
    }
    BENCHMARK_END("dummy for loop\n");

    RUN_TEST(test_add_function);
    RUN_TEST(test_set_bit_function);
    RUN_TEST(test_burn_and_die);
    RUN_TEST(test_crash);

    PRINT_TEST_SUMMARY();
}
/// !=======================================================================================================================
/// !                                                       TEST RUNNER
/// !=======================================================================================================================
